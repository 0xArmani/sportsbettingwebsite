<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sports Betting Profit Tracker</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background-color: #f4f4f9;
        }
        .container {
            max-width: 600px;
            margin: auto;
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        h1 {
            text-align: center;
        }
        input[type="number"] {
            padding: 8px;
            font-size: 16px;
            width: 100%;
            margin: 10px 0;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        button {
            padding: 10px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            width: 100%;
        }
        button:hover {
            background-color: #45a049;
        }
        .result {
            text-align: center;
            font-size: 20px;
            font-weight: bold;
        }
        .profit {
            color: green;
        }
        .loss {
            color: red;
        }
        .history {
            margin-top: 20px;
            border-top: 1px solid #ddd;
            padding-top: 10px;
        }
        .history table {
            width: 100%;
            border-collapse: collapse;
        }
        .history th, .history td {
            padding: 8px;
            text-align: center;
            border: 1px solid #ddd;
        }
        .history button {
            background-color: #f44336;
            color: white;
            border: none;
            padding: 5px 10px;
            cursor: pointer;
        }
        .history button:hover {
            background-color: #d32f2f;
        }
        canvas {
            margin-top: 20px;
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>Sports Betting Profit Tracker</h1>

        <label for="balance">Enter your ending balance for today:</label>
        <input type="number" id="balance" placeholder="Enter today's balance" />

        <label for="withdrawal">Enter any withdrawal amount for today (positive value):</label>
        <input type="number" id="withdrawal" placeholder="Enter withdrawal amount" />

        <button onclick="submitEntry()">Submit</button>

        <div class="result" id="result"></div>

        <!-- History of previous days' profit/losses -->
        <div class="history" id="history"></div>

        <!-- Canvas for displaying the graph -->
        <canvas id="profitChart" width="400" height="200"></canvas>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Retrieve stored history from localStorage
        let history = JSON.parse(localStorage.getItem("bettingHistory")) || [];

        // Function to submit the balance entry
        function submitEntry() {
            const currentBalance = parseFloat(document.getElementById("balance").value);
            const withdrawalAmount = parseFloat(document.getElementById("withdrawal").value);

            if (isNaN(currentBalance)) {
                alert("Please enter a valid balance.");
                return;
            }

            // If the withdrawal amount is negative, treat it as 0 (no withdrawal)
            const actualWithdrawal = isNaN(withdrawalAmount) ? 0 : withdrawalAmount;

            // Calculate profit or loss (compared to the last balance)
            let profitLoss = 0;
            if (history.length > 0) {
                const lastEntry = history[history.length - 1];
                profitLoss = currentBalance - lastEntry.balance - actualWithdrawal; // Subtract withdrawal from profit
            } else {
                // For the first entry, there is no previous balance, so treat profit/loss as 0
                profitLoss = 0;
            }

            // Get the current date and time
            const now = new Date();
            
            // If the time is between midnight and noon, adjust the date to the previous day
            if (now.getHours() < 12) {
                now.setDate(now.getDate() - 1); // Subtract one day
            }

            // Format the date as YYYY-MM-DD (you can customize the format)
            const formattedDate = now.toLocaleDateString();

            // Save the current balance, profit/loss, and withdrawal to history
            history.push({
                date: formattedDate,
                balance: currentBalance,
                profitLoss: profitLoss,
                withdrawal: actualWithdrawal
            });

            // Store updated history in localStorage
            localStorage.setItem("bettingHistory", JSON.stringify(history));

            // Display result (profit or loss)
            let resultText = "";
            let resultClass = "";

            if (profitLoss > 0) {
                resultText = `Profit: $${profitLoss.toFixed(2)}`;
                resultClass = "profit";
            } else if (profitLoss < 0) {
                resultText = `Loss: $${Math.abs(profitLoss).toFixed(2)}`;
                resultClass = "loss";
            } else {
                resultText = "No change in balance.";
                resultClass = "";
            }

            // Show result
            document.getElementById("result").innerText = resultText;
            document.getElementById("result").className = `result ${resultClass}`;

            // Update the history table
            displayHistory();

            // Update the graph with new data
            updateGraph();
        }

        // Function to display the history of bets
        function displayHistory() {
            const historyTable = document.getElementById("history");
            if (history.length === 0) {
                historyTable.innerHTML = "<p>No entries yet.</p>";
                return;
            }

            let tableHTML = `<table>
                                <thead>
                                    <tr>
                                        <th>Date</th>
                                        <th>Balance</th>
                                        <th>Profit/Loss</th>
                                        <th>Withdrawal</th>
                                        <th>Action</th>
                                    </tr>
                                </thead>
                                <tbody>`;
            history.forEach((entry, index) => {
                tableHTML += `<tr>
                                <td>${entry.date}</td>
                                <td>$${entry.balance.toFixed(2)}</td>
                                <td class="${entry.profitLoss >= 0 ? 'profit' : 'loss'}">$${entry.profitLoss.toFixed(2)}</td>
                                <td>$${entry.withdrawal.toFixed(2)}</td>
                                <td><button onclick="deleteEntry(${index})">Delete</button></td>
                            </tr>`;
            });
            tableHTML += `</tbody></table>`;
            historyTable.innerHTML = tableHTML;
        }

        // Function to delete an entry from history
        function deleteEntry(index) {
            // Remove the entry from the history array
            history.splice(index, 1);

            // Update the history in localStorage
            localStorage.setItem("bettingHistory", JSON.stringify(history));

            // Update the history table and graph
            displayHistory();
            updateGraph();
        }

        // Function to update the graph with new data
        function updateGraph() {
            const dates = history.map(entry => entry.date);
            const profits = history.map(entry => entry.profitLoss);

            const ctx = document.getElementById("profitChart").getContext("2d");

            // Destroy the previous chart if it exists to avoid stacking new ones
            if (window.profitChart) {
                window.profitChart.destroy();
            }

            // Create the graph
            window.profitChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: dates,
                    datasets: [{
                        label: 'Profit/Loss',
                        data: profits,
                        borderColor: profits.map(p => p >= 0 ? 'green' : 'red'),
                        backgroundColor: 'rgba(0, 123, 255, 0.1)',
                        borderWidth: 2,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Sports Betting Profit/Loss Over Time'
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                        }
                    }
                }
            });
        }

        // Initialize the history table and graph on page load
